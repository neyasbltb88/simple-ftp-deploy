# Simple FTP Deploy
Этот репозиторий представляет собой удобный пример конфига для библиотеки [**ftp-deploy**](https://www.npmjs.com/package/ftp-deploy), позволяющей организовать автоматческую выгрузку проекта на хостинг без использования сборщиков проекта.

## Установка
Для работы нам понадобится установить в свой проект саму библиотеку [**ftp-deploy**](https://www.npmjs.com/package/ftp-deploy): 

```
npm install --save-dev ftp-deploy
```

Так же, для кроссплатформенной передачи переменных окружения, установим глобально npm-пакет [**cross-env**](https://www.npmjs.com/package/cross-env):

```
npm install -g cross-env
```

После установки библиотек, копируем в корень своего проекта 3 файла из этого репозитория: [deploy.js](./deploy.js), [deploy_auth.js](./deploy_auth.js) и [deploy_rules.js](./deploy_rules.js)(не обязательный).

## Описание файлов
### deploy.js:
Основной файл, выполняющий конфигурацию ftp-deploy и логгирующий процесс выгрузки файлов.

### deploy_auth.js:
Файл, экспортирующий объект авторизации на ftp-хостинге.

> ***Настоятельно рекомендуется добавлять этот файл в `.gitignore`, если вы собираетесь размещать проект в открытом репозитории!***

**Этот объект должен содержать следующие поля:**

`user` - Имя пользователя для авторизации на ftp-хостинге

`password` - Пароль пользователя для авторизации на ftp-хостинге

`host` - Адрес ftp-хостинга

`port` - Порт ftp-хостинга (по умолчанию: 21)

`hostFolder` - Папка на ftp-хостинге, в которую нужно выгружать проект

`remoteRoot` - Корневая папка на ftp-хостинге

`baseUrl` - Адрес сайта, который связан с ftp-хостингом

Выгрузка проекта происходит по пути `remoteRoot + hostFolder`. При старте выгрузки в консоли выводится адрес проекта на сайте `baseUrl + hostFolder`.

### deploy_rules.js:
Файл, экспортирующий объект с правилами выгрузки:
```js
module.exports = {
    rule1: {
        localRoot: String,
        include: Array,
        exclude: Array,
        deleteRemote: Boolean,
        forcePasv: Boolean
    },
    rule2: {...},
    rule3: {...}
    ...
}
```

`localRoot` - Папка с выгружаемыми файлами, путь к которой отсчитывается относительно расположения файла deploy.js (по умолчанию: Папка расположения deploy.js)

`include` - Массив имен файлов, включаемых в выгрузку. Указанные пути отсчитываются от `localRoot` (по умолчанию: `["**/*.*", "**/.*"]`)

`exclude` -  Массив имен файлов, исключаемых из выгрузки. Указанные пути отсчитываются от `localRoot` (по умолчанию: `["**/*.map", "node_modules/**", "node_modules/**/*.*", "node_modules/**/.*"]`)

`deleteRemote` - Удалять все файлы в папке назначения на ftp перед выгрузкой (по умолчанию: `false`)

`forcePasv` - Принудительный пассивный режим (по умолчанию: `true`)

Правило может иметь только некоторые из этих свойств, в остальные будут подставлены значения по умолчанию. Чтобы переопределить значения по умолчанию, создайте правило с именем `default`. В нем так же, можно переопределять только некоторые свойства или все сразу.

> Файл deploy_rules не обязательный. Если он отсутствует, то применяется правило по умолчанию - `default`.

## Выгрузка с использованием правил

Для примера создадим слеующие правила в файле `deploy_rules.js`:

```js
module.exports = {
    default: {
        localRoot: 'test',
    },
    fast: {
        exclude: [
            'img/**/*.*',

            '**/*.map',
            'node_modules/**',
            'node_modules/**/*.*',
            'node_modules/**/.*'
        ],
    }
}
```

Таким образом мы указываем, что все правила должны брать файлы для выгрузки из папки `test`, а правило `fast` не должно выгружать на хост изображения из папки `test/img`, файлы sourcemap и содержимое `node_modules`.

1. Открываем терминал в корневой папке проекта (или в папке, где находится файл `deploy.js`).
2. Для выгрузки по умолчанию (всех файлов из папки `test`) набираем: `node deploy`.
3. Для выгрузки по правилу `fast`, передаем в переменную окружения название правила: `cross-env RULE=fast node deploy`.

Для удобства можно добавить различные варианты выгрузки в секцию `scripts` файла `package.json`:

```json
"scripts": {
    "deploy": "node deploy",
    "deploy:fast": "cross-env RULE=fast node deploy"
}
```

Так же можно комбинировать выгрузку со сборкой проекта:

```json
"scripts": {
    "deploy": "node deploy",
    "deploy:fast": "cross-env RULE=fast node deploy",
    "build": "build",
    "build:deploy": "build && npm run deploy:fast"
}
```